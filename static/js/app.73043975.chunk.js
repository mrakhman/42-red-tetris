(this.webpackJsonp=this.webpackJsonp||[]).push([[0],{10:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return a}));var r={CREATE_USER:"create user",FETCH_CURRENT_PLAYER:"fetch current player",CHOOSE_ROOM:"create or join room",ENTER_ROOM:"enter room",UPDATE_ROOM_PLAYERS:"update room players",PLAYER_LEFT:"player left",START_GAME:"start game",PAUSE_GAME:"pause game",PENALTY_ROWS:"penalty rows",UPDATE_SPECTRUM:"update spectrum",FETCH_WAITING_ROOMS:"fetch waiting rooms",UPDATE_WAITING_ROOMS:"update waiting rooms",GAMEOVER:"gameover",FETCH_ROOM_RANKING:"fetch room ranking",UPDATE_SCORE:"update score",REDIRECT_TO_RANKING:"redirect to ranking",CHAT_MESSAGE:"chat message",FORBIDDEN:"access forbidden"},a={ROW_DESTROYED:10,PIECE_PLACED:4,LAST_PLAYER:200}},106:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=4},242:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(243),a=n(0),o=n.n(a),s=n(429),i=n(244);function c(){return window.addEventListener("keydown",(function(e){32===e.keyCode&&e.target==document.body&&e.preventDefault()})),o.a.createElement(s.b,null,o.a.createElement(i.a,null),o.a.createElement(r.StatusBar,null))}},244:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return O}));var r=n(5),a=n.n(r),o=n(170),s=n(168),i=n(73),c=n(428),l=n(0),u=n.n(l),m=n(245),f=n(307),d=n(304),E=n(284),p=n(285),b=n(288),g=n.n(b),h=n(45),y=n(38);function O(e){var t=e.colorScheme;return u.a.createElement(o.a,{linking:p.a,theme:"dark"===t?s.a:i.a},u.a.createElement(v,null))}var C=Object(c.a)();function v(){var t=Object(l.useState)(void 0),n=a()(t,2),r=n[0],o=n[1],s=Object(l.useState)({username:void 0,room:void 0}),i=a()(s,2),c=i[0],p=i[1];return u.a.createElement(h.a.Provider,{value:function(){if(r)return r;var t=g()(""+(e&&Object({NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{scheme:"red-tetris",name:"red-tetris",slug:"red-tetris",version:"1.0.0",orientation:"portrait",icon:"./assets/icon.png",splash:{image:"./assets/splash.png",resizeMode:"contain",backgroundColor:"#ffffff"},updates:{fallbackToCacheTimeout:0},assetBundlePatterns:["**/*"],web:{},sdkVersion:"38.0.0",platforms:["ios","android","web"]}})&&Object({NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{scheme:"red-tetris",name:"red-tetris",slug:"red-tetris",version:"1.0.0",orientation:"portrait",icon:"./assets/icon.png",splash:{image:"./assets/splash.png",resizeMode:"contain",backgroundColor:"#ffffff"},updates:{fallbackToCacheTimeout:0},assetBundlePatterns:["**/*"],web:{},sdkVersion:"38.0.0",platforms:["ios","android","web"]}}).SERVER_URL||"http://localhost:3001"));return o(t),t}()},u.a.createElement(y.a.Provider,{value:{userContext:c,setUserContext:p}},u.a.createElement(C.Navigator,{screenOptions:{headerShown:!1}},u.a.createElement(C.Screen,{name:"Root",component:f.a}),u.a.createElement(C.Screen,{name:"Playground",component:d.a}),u.a.createElement(C.Screen,{name:"Ranking",component:E.a}),u.a.createElement(C.Screen,{name:"NotFound",component:m.a,options:{title:"Oops!"}}))))}}).call(this,n(15))},245:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(0),a=n(4),o=n(9),s=n(46),i=n(2);function c(e){var t=e.navigation;return r.createElement(i.a,{style:l.container},r.createElement(o.a,{style:l.title},"This screen doesn't exist."),r.createElement(s.a,{onPress:function(){return t.replace("Root")},style:l.link},r.createElement(o.a,{style:l.linkText},"Go to home screen!")))}var l=a.a.create({container:{flex:1,backgroundColor:"#fff",alignItems:"center",justifyContent:"center",padding:20},title:{fontSize:20,fontWeight:"bold"},link:{marginTop:15,paddingVertical:15},linkText:{fontSize:14,color:"#2e78b7"}})},284:function(e,t,n){"use strict";var r=n(5),a=n.n(r),o=n(0),s=n.n(o),i=n(7),c=n.n(i),l=n(4),u=n(2),m=n(9),f=n(21),d=n(84),E=n(10),p=n(45),b=n(38),g=l.a.create({title:{fontSize:26,fontWeight:"bold",alignSelf:"center",marginBottom:"10%"},subtitle:{fontSize:24,alignSelf:"center",marginBottom:"10%"},tableContainer:{width:300,flexDirection:"row",justifyContent:"space-between"},tableHeader:{fontSize:18,fontWeight:"bold"},tableContent:{fontSize:18,marginBottom:3,marginTop:3}});t.a=function(){var e=Object(o.useContext)(p.a),t=Object(o.useContext)(b.a),n=(t.userContext,t.setUserContext,Object(f.useRoute)().params),r=null!=n?n:{},i=r.room,l=r.username,h=Object(o.useState)([]),y=a()(h,2),O=y[0],C=y[1];console.log("roomPlayers:",O);var v=function(){console.log("aaaaaaaaaaaa forbidden")},S=function(e){C(e)};return Object(o.useEffect)((function(){if(!e)throw Error("No socket");return e.emit(E.b.FETCH_ROOM_RANKING,{username:l,roomName:i,gameMode:"not solo"}),e.on(E.b.FORBIDDEN,v),e.on(E.b.FETCH_ROOM_RANKING,S),function(){e.removeListener(E.b.FORBIDDEN,v),e.removeListener(E.b.FETCH_ROOM_RANKING,S)}}),[]),s.a.createElement(d.a,null,s.a.createElement(u.a,{style:{justifyContent:"space-between"}},s.a.createElement(m.a,{style:g.title},"Game report"),l&&O.length>1&&l===O[0].username?s.a.createElement(m.a,{style:g.subtitle},l,", you are the winner!"):s.a.createElement(m.a,{style:g.subtitle},l," @ ",i),s.a.createElement(u.a,{style:g.tableContainer},s.a.createElement(u.a,null,s.a.createElement(m.a,{style:g.tableHeader},"Place"),c.a.map(O,(function(e,t){return s.a.createElement(m.a,{key:t,style:g.tableContent},t+1)}))),s.a.createElement(u.a,null,s.a.createElement(m.a,{style:g.tableHeader},"Name"),c.a.map(O,(function(e,t){return s.a.createElement(m.a,{key:t,style:g.tableContent},e.username)}))),s.a.createElement(u.a,null,s.a.createElement(m.a,{style:g.tableHeader},"Score"),c.a.map(O,(function(e,t){return s.a.createElement(m.a,{key:t,style:g.tableContent},e.score)}))))))}},285:function(e,t,n){"use strict";var r=n(286);t.a={prefixes:[r.makeUrl("/")],config:{screens:{Root:"/",Playground:"/play",Ranking:"/ranking",NotFound:"*"}}}},304:function(e,t,n){"use strict";n.d(t,"a",(function(){return ee}));var r,a=n(13),o=n.n(a),s=n(29),i=n.n(s),c=n(5),l=n.n(c),u=n(0),m=n.n(u),f=n(7),d=n.n(f),E=n(2),p=n(9),b=n(278),g=n(21),h=n(10),y={I:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],L:[[0,0,1],[1,1,1],[0,0,0]],J:[[1,0,0],[1,1,1],[0,0,0]],Z:[[1,1,0],[0,1,1],[0,0,0]],S:[[0,1,1],[1,1,0],[0,0,0]],O:[[1,1],[1,1]],T:[[0,1,0],[1,1,1],[0,0,0]]},O={I:[-2,3],L:[-2,4],J:[-2,4],Z:[-2,4],S:[-2,4],O:[-2,4],T:[-2,4]},C=["I","L","J","Z","S","O","T"];!function(e){e[e.FREE=0]="FREE",e[e.OCCUPIED=1]="OCCUPIED",e[e.BLOCKED=2]="BLOCKED"}(r||(r={}));d.a.fill(Array(10),r.OCCUPIED);var v=d.a.fill(Array(10),r.FREE),S=d.a.fill(Array(10),r.BLOCKED),P=d.a.map(Array(20),(function(){return d.a.fill(Array(10),r.FREE)})),R=d.a.map(Array(2),(function(){return d.a.fill(Array(4),r.FREE)})),w=(n(368),n(95)),T=n(433),_=n(281);function A(e){var t=e.style,r=T.a.fromModule(n(378)).uri;return u.createElement(E.a,{style:[{flexDirection:"row"},t]},d.a.map(Array(6),(function(e,t){return u.createElement(_.a,{key:t,source:{uri:r},style:{width:14,height:24,overflow:"hidden"},imageStyle:{height:186,left:-215,resizeMode:"cover",top:-25,width:400}})})))}var k=function(e){return e&&0!==e.length?e.map((function(e){return e.username})):[]},N=n(84),x=n(4),L=x.a.create({outer:{alignItems:"center",borderColor:"#879372",borderWidth:1,height:20,justifyContent:"center",width:20},outerSpectrum:{alignItems:"center",borderColor:"#879372",borderWidth:1,height:6,justifyContent:"center",width:6},inner:{height:12,width:12,backgroundColor:"#879372"},innerSpectrum:{height:2,width:2,backgroundColor:"#879372"}}),I=function(e){var t=e.value;return e.isSpectrum?u.createElement(E.a,{style:[L.outerSpectrum,t===r.OCCUPIED||t===r.BLOCKED?{borderColor:"black"}:void 0]},u.createElement(E.a,{style:[L.innerSpectrum,t===r.OCCUPIED?{backgroundColor:"black"}:t===r.BLOCKED?{backgroundColor:"transparent"}:void 0]})):u.createElement(E.a,{style:[L.outer,t===r.OCCUPIED||t===r.BLOCKED?{borderColor:"black"}:void 0]},u.createElement(E.a,{style:[L.inner,t===r.OCCUPIED?{backgroundColor:"black"}:t===r.BLOCKED?{backgroundColor:"transparent"}:void 0]}))},j=function(e){var t=e.pos,n=e.shape,r=e.type,a=e.timeStamp;return{pos:null!=t?t:O[r],shape:null!=n?n:y[r],type:r,timeStamp:null!=a?a:Date.now()}},M=function(e){var t=e.shape,n=t[0].map((function(e,n){return t.map((function(e){return e[n]})).reverse()}));return{pos:e.pos,shape:n,type:e.type,timeStamp:e.timeStamp}},D=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return{pos:[e.pos[0]+t,e.pos[1]],shape:e.shape,type:e.type,timeStamp:e.timeStamp}},U=function(e){return{pos:[e.pos[0],e.pos[1]+1],shape:e.shape,type:e.type,timeStamp:e.timeStamp}},z=function(e){return{pos:[e.pos[0],e.pos[1]-1],shape:e.shape,type:e.type,timeStamp:e.timeStamp}},B=function(e){var t=[];return d.a.map(e.shape,(function(n,r){return d.a.map(n,(function(n,a){n&&t.push([r+e.pos[0],a+e.pos[1]])}))})),t},F=function(e,t){return void 0!==d.a.find(B(e),(function(e){return d.a.isEqual(e,t)}))},W=function(e,t){var n=d.a.find(B(e),(function(e){var n,a,o=l()(e,2),s=o[0],i=o[1];return(null==t||null==(n=t[s])?void 0:n[i])===r.BLOCKED||(null==t||null==(a=t[s])?void 0:a[i])===r.OCCUPIED})),a=function(e){var t,n,r,a,o=d.a.map(B(e),(function(e){return l()(e,1)[0]})),s=d.a.map(B(e),(function(e){return l()(e,2)[1]}));return{left:null!=(t=d.a.min(s))?t:0,top:null!=(n=d.a.min(o))?n:0,right:null!=(r=d.a.max(s))?r:0,bottom:null!=(a=d.a.max(o))?a:0}}(e),o=a.left,s=a.right;return a.bottom<20&&o>=0&&s<10&&!n},G=function(e,t){var n=d.a.cloneDeep(t);return d.a.map(B(e),(function(e){e[0]>=0&&e[0]<d.a.size(n)&&e[1]>=0&&e[1]<d.a.size(n[0])&&(n[e[0]][e[1]]=r.OCCUPIED)})),n},V=function(e){var t=e.block,n=e.matrix,a=e.style,o=e.isSpectrum,s=o?8:22;return u.createElement(E.a,{style:[H.container,{height:d.a.size(n)*s},a]},d.a.map(n,(function(e,n){return u.createElement(E.a,{key:n,style:{flexDirection:"row",width:d.a.size(e)*s,justifyContent:"space-between"}},d.a.map(e,(function(e,a){return u.createElement(I,{key:a,isSpectrum:o,value:F(t,[n,a])?r.OCCUPIED:e})})))})))},H=x.a.create({container:{padding:2,justifyContent:"space-between",borderColor:"black",borderWidth:1,backgroundColor:"#9ead86"}}),Y=n(283),K=n.n(Y),J=n(36),Z=function(e){var t=e.setIsPause,n=e.setMatrix,r=e.setBlock;K()((function(e,a){var o=a.keyCode;if(!Object(w.isWidgetOpened)()){var s;if(o===J.a.reset)r(j({type:null!=(s=d.a.sample(C))?s:"T"})),n(P),t(!0);t((function(e){return n((function(t){return e||(o===J.a.rotate&&r((function(e){return W(M(e),t)?M(e):e})),o===J.a.left&&r((function(e){return W(z(e),t)?z(e):e})),o===J.a.right&&r((function(e){return W(U(e),t)?U(e):e})),o===J.a.down&&r((function(e){return W(D(e),t)?D(e):(n(G(e,t)),e)})),o===J.a.space&&r((function(e){var r=function(e,t){for(var n=j({type:e.type,pos:e.pos,shape:e.shape});W(D(n),t);)n=D(n);return n}(e,t);return n(G(r,t)),r}))),t})),e}))}}))},q=n(45),Q=n(38);function X(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?X(Object(n),!0).forEach((function(t){i()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):X(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function ee(){var e,t,n=Object(u.useContext)(q.a),a=Object(u.useContext)(Q.a),s=a.userContext,i=a.setUserContext,c=Object(g.useNavigation)(),f=Object(g.useRoute)().params,y=null!=f?f:{},O=y.room,T=y.username,_=Object(u.useState)([]),x=l()(_,2),L=x[0],I=x[1],M=Object(u.useState)(j({type:null!=(e=d.a.sample(C))?e:"T"})),U=l()(M,2),z=U[0],B=U[1],F=Object(u.useState)(P),H=l()(F,2),Y=H[0],K=H[1],J=Object(u.useState)(!0),X=l()(J,2),ee=X[0],te=X[1],ne=Object(u.useState)(),re=l()(ne,2),ae=re[0],oe=re[1],se=Object(u.useState)(),ie=l()(se,2),ce=ie[0],le=ie[1],ue=Object(u.useState)(!1),me=l()(ue,2),fe=me[0],de=me[1],Ee=Object(u.useState)(!1),pe=l()(Ee,2),be=pe[0],ge=pe[1],he=d.a.includes(s.room,"solo")||d.a.includes(O,"solo");Z({setBlock:B,setMatrix:K,setIsPause:te});var ye=function(e){Object(w.addResponseMessage)(e.username+": "+e.text,e.username)},Oe=function(e){oe(e),console.log("FETCH_CURRENT_PLAYER",e)},Ce=function(e){I(e.players);var t=d.a.find(e.players,(function(e){return e.isLeader}));le(t),oe((function(e){return e&&t&&e.id===t.id?t:e}))},ve=function(e){var t=e.tilesStack,n=e.startTile;console.log("START_GAME",n,t,ee),ge(!0),te(!1)},Se=function(){te((function(e){return!e}))},Pe=function(e){K((function(t){var n=Ne(t,e);return console.log("PENALTY_ROWS receive. rowsNumber, newMatrix:",e,n),n}))},Re=function(){if(!n)throw Error("No socket");oe((function(e){if(e)return n.emit(h.b.UPDATE_SCORE,{username:e.username,roomName:e.room,score:e.score,isSoloMode:he}),e}))},we=function(){c.push("Ranking",{username:T,room:O})},Te=function(e){var t=e.players,n=e.endGame,r=d.a.find(t,(function(e){return e.isWinner}));oe((function(e){return e&&r&&r.username===e.username?$($({},e),{},{score:e.score+h.a.LAST_PLAYER}):e})),n&&(Re(),te(!0),K(P),de(!0))},_e=function(e){console.log("SOCKET.UPDATE_SPECTRUM, roomPlayers",e),I(e)};Object(u.useEffect)((function(){if(Object(w.dropMessages)(),s.username&&s.room||i({username:T,room:O}),console.log("Playground, User context:",s),!n)throw Error("No socket");return n.emit(h.b.ENTER_ROOM,{username:T,roomName:O}),n.on(h.b.FETCH_CURRENT_PLAYER,Oe),n.on(h.b.REDIRECT_TO_RANKING,we),he||(n.on(h.b.CHAT_MESSAGE,ye),n.on(h.b.UPDATE_ROOM_PLAYERS,Ce),n.on(h.b.START_GAME,ve),n.on(h.b.PAUSE_GAME,Se),n.on(h.b.PENALTY_ROWS,Pe),n.on(h.b.GAMEOVER,Te),n.on(h.b.UPDATE_SPECTRUM,_e)),function(){n.emit(h.b.PLAYER_LEFT,T),n.removeListener(h.b.CHAT_MESSAGE,ye),n.removeListener(h.b.FETCH_CURRENT_PLAYER,Oe),n.removeListener(h.b.UPDATE_ROOM_PLAYERS,Ce),n.removeListener(h.b.START_GAME,Se),n.removeListener(h.b.PAUSE_GAME,ve),n.removeListener(h.b.PENALTY_ROWS,Pe),n.removeListener(h.b.GAMEOVER,Te),n.removeListener(h.b.UPDATE_SPECTRUM,_e),n.removeListener(h.b.REDIRECT_TO_RANKING,we),Object(w.dropMessages)()}}),[]);var Ae,ke,Ne=function(e,t){var n=Array(t).fill(S),r=d.a.cloneDeep([].concat(o()(e),o()(n)));return d.a.slice(r,t,r.length)},xe=C[0];return Object(b.a)((function(){ee||(d.a.includes(Y[0],1)?(K(P),te(!0),de(!0),function(){if(he)Re();else{if(!n)throw Error("No socket");n.emit(h.b.GAMEOVER,{username:s.username,roomName:s.room})}}()):B((function(e){if(W(D(e),Y))return D(e);var t=function(e){var t=[],n=[];return d.a.map(e,(function(e){d.a.sum(e)<10||d.a.sum(e)>10?t=d.a.cloneDeep([].concat(o()(t),[e])):n=d.a.cloneDeep([].concat(o()(n),[v]))})),console.log("Destroy",d.a.cloneDeep([].concat(o()(n),o()(t)))),{newMatrix:d.a.cloneDeep([].concat(o()(n),o()(t))),deletedRows:n.length}}(G(z,Y)),a=t.newMatrix,i=t.deletedRows;return K(a),i>0&&function(e){if(!n)throw Error("No socket");console.log("PENALTY_ROWS emit, rowsNumber:",e),n.emit(h.b.PENALTY_ROWS,{username:T,roomName:O,rowsNumber:e})}(i),function(e){if(!n)throw Error("No socket");n.emit(h.b.UPDATE_SPECTRUM,{username:s.username,roomName:s.room,spectrum:e})}(function(e){for(var t=d.a.cloneDeep(e),n=0;n<e[0].length;n++)for(var a=!1,o=0;o<e.length;o++)e[o][n]===r.OCCUPIED&&(a=!0),a&&(t[o][n]=r.OCCUPIED);return t}(a)),oe((function(e){if(e)return $($({},e),{},{score:e.score+h.a.PIECE_PLACED+h.a.ROW_DESTROYED*i})})),j({type:xe})})))}),500),m.a.createElement(m.a.Fragment,null,m.a.createElement(N.a,{isPause:ee,setIsPause:te,roomPlayers:k(L),isLeader:null==ae?void 0:ae.isLeader,gameStarted:be,gameover:fe,isSoloMode:he},m.a.createElement(m.a.Fragment,null,T&&O&&m.a.createElement(p.a,{style:{fontSize:16,marginBottom:10,alignSelf:"flex-start"}},T," @ ",O),m.a.createElement(E.a,{style:{position:"absolute",zIndex:1,marginLeft:600}},m.a.createElement(p.a,null,null==ae?void 0:ae.score),d.a.map(function(e,t){return d.a.filter(e,(function(e){return e.username!==t}))}(L,s.username||""),(function(e){return m.a.createElement(E.a,{key:e.id,style:{width:85}},m.a.createElement(E.a,{style:{alignItems:"center"}},m.a.createElement(p.a,{style:{fontWeight:"bold",color:"white"}},e.username)),m.a.createElement(V,{matrix:e.spectrum,isSpectrum:!0,block:j({type:xe,pos:[-10,-10]})}))}))),m.a.createElement(E.a,{style:{flexDirection:"row",alignSelf:"flex-start",width:"100%"}},m.a.createElement(V,{matrix:Y,block:z}),m.a.createElement(E.a,{style:{marginLeft:20,flex:1}},m.a.createElement(p.a,{style:{fontSize:20}},"Score"),m.a.createElement(A,{style:{marginVertical:10,alignSelf:"flex-end"}}),m.a.createElement(p.a,{style:{fontSize:20}},"Start Line"),m.a.createElement(A,{style:{marginVertical:10,alignSelf:"flex-end"}}),m.a.createElement(p.a,{style:{fontSize:20}},"Level"),m.a.createElement(A,{style:{marginVertical:10,alignSelf:"flex-end"}}),m.a.createElement(p.a,{style:{fontSize:20}},"Next"),m.a.createElement(V,{matrix:R,block:j({type:xe,pos:[0,0]}),style:{borderWidth:0,marginVertical:10,alignSelf:"flex-end"}}))))),!he&&m.a.createElement(w.Widget,{title:(ke=null!=(t=null==ce?void 0:ce.username)?t:"no leader","Leader: "+ke),subtitle:(Ae=k(L),0===Ae.length?"No players":"Players: "+Ae.join(", ")),handleNewUserMessage:function(e){if(!n)throw Error("No socket");n.emit(h.b.CHAT_MESSAGE,{username:T,message:e,roomName:O})}}))}},307:function(e,t,n){"use strict";n.d(t,"a",(function(){return O})),n.d(t,"b",(function(){return C}));var r=n(5),a=n.n(r),o=n(0),s=n.n(o),i=n(2),c=n(4),l=n(9),u=n(46),m=n(47),f=n(10),d=n(74),E=n(45),p=n(38);function b(e){var t=e.setScreenNumber,n=Object(o.useContext)(p.a),r=n.userContext,c=n.setUserContext,b=r.username,g=Object(o.useContext)(E.a),h=Object(o.useState)(""),y=a()(h,2),O=y[0],v=y[1];return s.a.createElement(i.a,{style:{width:"100%",alignItems:"center"}},s.a.createElement(i.a,{style:{width:"90%"}},s.a.createElement(l.a,{style:C.title},"Username"),s.a.createElement(l.a,{style:C.error},O)),s.a.createElement(m.a,{value:null!=b?b:"",onChangeText:function(e){v(""),c({username:e,room:void 0})},style:C.input}),s.a.createElement(u.a,{style:C.button,onPress:function(){Object(d.b)(b).then((function(e){if(!0===e){if(!g)throw Error("No socket");g.emit(f.b.CREATE_USER,b),t(2)}})).catch((function(e){v(e.message)}))}},s.a.createElement(l.a,{style:C.linkText},"Next")))}var g=n(21);function h(e){var t=e.setScreenNumber,n=Object(o.useContext)(p.a),r=n.userContext,c=n.setUserContext,b=r.username,h=r.room,y=Object(o.useContext)(E.a),O=Object(g.useNavigation)(),v=Object(o.useState)(""),S=a()(v,2),P=S[0],R=S[1],w=Object(o.useState)(""),T=a()(w,2),_=T[0],A=T[1],k=Object(o.useState)([]),N=a()(k,2),x=N[0],L=N[1];b||t(1),console.log("Updates for waitingRooms:",x);var I=function(e){return L(e)},j=function(e){return R(""),A(""),L(e)},M=function(e){if(!y)throw Error("No socket");y.emit(f.b.CHOOSE_ROOM,{username:b,roomName:e}),b&&e&&O.push("Playground",{username:b,room:e})};Object(o.useEffect)((function(){if(!y)throw Error("No socket");return y.emit(f.b.FETCH_WAITING_ROOMS),y.on(f.b.FETCH_WAITING_ROOMS,I),y.on(f.b.UPDATE_WAITING_ROOMS,j),function(){y.removeListener(f.b.FETCH_WAITING_ROOMS,I),y.removeListener(f.b.UPDATE_WAITING_ROOMS,j)}}),[]);return s.a.createElement(i.a,{style:{width:"100%",alignItems:"center"}},s.a.createElement(u.a,{style:C.button,onPress:function(){return R(""),A(""),c({username:b,room:Object(d.c)(b)}),void M(Object(d.c)(b))}},s.a.createElement(l.a,{style:C.linkText},"Play solo")),s.a.createElement(i.a,{style:{width:"90%"}},s.a.createElement(l.a,{style:C.title},"Room name"),s.a.createElement(l.a,{style:C.error},P)),s.a.createElement(m.a,{value:null!=h?h:"",onChangeText:function(e){R(""),A(""),c({username:b,room:e})},style:C.input}),s.a.createElement(u.a,{style:C.button,onPress:function(){return function(e){Object(d.a)(e).then((function(n){!0===n&&(M(e),t(1))})).catch((function(e){A(""),R(e.message)}))}(h)}},s.a.createElement(l.a,{style:C.linkText},"Create")),s.a.createElement(i.a,{style:{width:"90%"}},x.length>0&&s.a.createElement(l.a,{style:C.title},"Join room"),s.a.createElement(l.a,{style:C.error},_),x.length>0&&x.map((function(e){return s.a.createElement(i.a,{key:e},s.a.createElement(u.a,{style:C.roomsList,onPress:function(){return function(e){R(""),A(""),Object(d.d)(e).then((function(n){!0===n&&(c({username:b,room:e}),M(e),t(1))})).catch((function(e){R(""),A(e.message)}))}(e)}},s.a.createElement(l.a,null,e)))}))))}var y=n(84);function O(){var e=Object(o.useState)(1),t=a()(e,2),n=t[0],r=t[1];return s.a.createElement(y.a,null,s.a.createElement(i.a,{style:{alignItems:"center",width:"60%"}},1===n?s.a.createElement(b,{setScreenNumber:r}):s.a.createElement(h,{setScreenNumber:r})))}var C=c.a.create({title:{marginTop:30,marginBottom:5,alignSelf:"flex-start",textAlign:"center"},error:{marginBottom:5,alignSelf:"flex-start",textAlign:"center",color:"#980f0f"},linkText:{fontSize:14},roomsList:{borderWidth:1,borderRadius:5,margin:3,padding:2,alignItems:"center"},button:{width:"70%",borderWidth:1,borderRadius:10,alignItems:"center",padding:3,marginBottom:10},input:{borderWidth:1,marginBottom:20,height:30,width:"90%"}})},319:function(e,t,n){n(320),e.exports=n(426)},320:function(e,t){"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("/expo-service-worker.js",{scope:"/"}).then((function(e){})).catch((function(e){console.info("Failed to register service-worker",e)}))}))},36:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r={left:37,rotate:38,right:39,down:40,space:32,sound:83,reset:82}},378:function(e,t,n){e.exports=n.p+"static/media/sprite.81de6409.png"},38:function(e,t,n){"use strict";var r=n(0),a={username:void 0,room:void 0},o=Object(r.createContext)({userContext:a,setUserContext:function(){}});t.a=o},408:function(e,t){},45:function(e,t,n){"use strict";var r=n(0),a=Object(r.createContext)(void 0);t.a=a},74:function(e,t,n){"use strict";(function(e){n.d(t,"b",(function(){return d})),n.d(t,"a",(function(){return E})),n.d(t,"d",(function(){return p})),n.d(t,"c",(function(){return b}));var r=n(11),a=n.n(r),o=n(153),s=n.n(o),i=n(7),c=n.n(i),l=n(106),u=function(e){return void 0===e||null===e||""===e},m=function(e){return!u(e)&&!(e&&e.length>15)},f=function(e){var t=new RegExp("\\W");return!!e&&!e.match(t)},d=function(t){var n;return a.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(m(t)){r.next=2;break}throw Error("Name must be 1-15 symbols");case 2:if(f(t)){r.next=4;break}throw Error("Use letters and numbers");case 4:return r.next=6,a.a.awrap(s.a.get((e&&Object({NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{scheme:"red-tetris",name:"red-tetris",slug:"red-tetris",version:"1.0.0",orientation:"portrait",icon:"./assets/icon.png",splash:{image:"./assets/splash.png",resizeMode:"contain",backgroundColor:"#ffffff"},updates:{fallbackToCacheTimeout:0},assetBundlePatterns:["**/*"],web:{},sdkVersion:"38.0.0",platforms:["ios","android","web"]}})&&Object({NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{scheme:"red-tetris",name:"red-tetris",slug:"red-tetris",version:"1.0.0",orientation:"portrait",icon:"./assets/icon.png",splash:{image:"./assets/splash.png",resizeMode:"contain",backgroundColor:"#ffffff"},updates:{fallbackToCacheTimeout:0},assetBundlePatterns:["**/*"],web:{},sdkVersion:"38.0.0",platforms:["ios","android","web"]}}).SERVER_URL||"http://localhost:3001")+"/player/"+t));case 6:if(!(n=r.sent)||!u(n.data.username)){r.next=9;break}return r.abrupt("return",!0);case 9:throw Error("Username already taken");case 10:case"end":return r.stop()}}),null,null,null,Promise)},E=function(t){var n;return a.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:if(m(t)){r.next=2;break}throw Error("Name must be 1-15 symbols");case 2:if(f(t)){r.next=4;break}throw Error("Use letters and numbers");case 4:return r.next=6,a.a.awrap(s.a.get((e&&Object({NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{scheme:"red-tetris",name:"red-tetris",slug:"red-tetris",version:"1.0.0",orientation:"portrait",icon:"./assets/icon.png",splash:{image:"./assets/splash.png",resizeMode:"contain",backgroundColor:"#ffffff"},updates:{fallbackToCacheTimeout:0},assetBundlePatterns:["**/*"],web:{},sdkVersion:"38.0.0",platforms:["ios","android","web"]}})&&Object({NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{scheme:"red-tetris",name:"red-tetris",slug:"red-tetris",version:"1.0.0",orientation:"portrait",icon:"./assets/icon.png",splash:{image:"./assets/splash.png",resizeMode:"contain",backgroundColor:"#ffffff"},updates:{fallbackToCacheTimeout:0},assetBundlePatterns:["**/*"],web:{},sdkVersion:"38.0.0",platforms:["ios","android","web"]}}).SERVER_URL||"http://localhost:3001")+"/room/"+t));case 6:if(!(n=r.sent)||!u(n.data.name)){r.next=9;break}return r.abrupt("return",!0);case 9:throw Error("Room name already taken");case 10:case"end":return r.stop()}}),null,null,null,Promise)},p=function(t){var n;return a.a.async((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,a.a.awrap(s.a.get((e&&Object({NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{scheme:"red-tetris",name:"red-tetris",slug:"red-tetris",version:"1.0.0",orientation:"portrait",icon:"./assets/icon.png",splash:{image:"./assets/splash.png",resizeMode:"contain",backgroundColor:"#ffffff"},updates:{fallbackToCacheTimeout:0},assetBundlePatterns:["**/*"],web:{},sdkVersion:"38.0.0",platforms:["ios","android","web"]}})&&Object({NODE_ENV:"production",PUBLIC_URL:"",APP_MANIFEST:{scheme:"red-tetris",name:"red-tetris",slug:"red-tetris",version:"1.0.0",orientation:"portrait",icon:"./assets/icon.png",splash:{image:"./assets/splash.png",resizeMode:"contain",backgroundColor:"#ffffff"},updates:{fallbackToCacheTimeout:0},assetBundlePatterns:["**/*"],web:{},sdkVersion:"38.0.0",platforms:["ios","android","web"]}}).SERVER_URL||"http://localhost:3001")+"/room/"+t));case 2:if(!((n=r.sent)&&n.data.players.length>=l.a)){r.next=5;break}throw Error("Too many players in the room");case 5:return r.abrupt("return",!0);case 6:case"end":return r.stop()}}),null,null,null,Promise)},b=function(e){return e?"solo_"+e:"solo_"+c.a.random(1e3)}}).call(this,n(15))},84:function(e,t,n){"use strict";n.d(t,"a",(function(){return v})),n.d(t,"b",(function(){return S}));var r=n(4),a=n(9),o=n(2),s=n(0),i=n.n(s),c=n(46),l=n(21),u=n(36),m=n(10),f=n(45),d=n(38),E=function(e){var t=e.size,n=e.color,r=e.label,s=e.style,l=e.onPress,u=e.disabled,m=e.text,f=i.a.useRef(null);return i.a.createElement(o.a,{style:[{alignItems:"center"},s]},i.a.createElement(c.a,{ref:f,disabled:u,onPress:function(){var e;null==f||null==(e=f.current)||e.blur(),null==l||l()},style:{backgroundColor:n,borderRadius:t/2,height:t,width:t,shadowColor:"rgba(0,0,0, .4)",shadowOffset:{height:1,width:1},shadowOpacity:20,shadowRadius:5,justifyContent:"center",alignItems:"center"}},m&&i.a.createElement(a.a,{style:{fontSize:25}},m)),r&&i.a.createElement(a.a,{style:{marginTop:10}},r))},p=function(e){var t=e.isPause,n=e.setIsPause,r=e.opponentsNumber,a=e.isLeader,c=e.gameStarted,p=e.disabled,b=e.isSoloMode,g=Object(s.useContext)(f.a),h=Object(s.useContext)(d.a),y=h.userContext,O=h.setUserContext,C=Object(l.useNavigation)(),v=!b&&a&&!c,S=a&&c||b,P=!b&&(p||r<1),R=function(e){document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:e,which:e}))};return i.a.createElement(o.a,{style:{width:400}},i.a.createElement(o.a,{style:{width:"100%"}},i.a.createElement(o.a,{style:{flexDirection:"row",marginVertical:20,justifyContent:"space-between"}},v&&i.a.createElement(E,{color:P?"#c0c0c0":"#2dc421",size:50,label:"Start",text:"\u25b6",disabled:P,onPress:function(){return function(){if(!g)throw Error("No socket");g.emit(m.b.START_GAME,{username:y.username,roomName:y.room})}()}}),S&&i.a.createElement(E,{disabled:P,color:P?"#c0c0c0":"#efcc19",size:50,label:t?"Play(P)":"Pause(P)",text:t?"\u25b6":"||",onPress:function(){return function(){if(b&&n&&n((function(e){return!e})),!g)throw Error("No socket");g.emit(m.b.PAUSE_GAME,{username:y.username,roomName:y.room})}()}}),i.a.createElement(E,{disabled:P,color:P?"#c0c0c0":"#2dc421",size:50,label:"Sound(S)",onPress:function(){return R(u.a.sound)}}),i.a.createElement(E,{disabled:P,color:P?"#c0c0c0":"#efcc19",size:50,label:"Reset(R)",onPress:function(){return R(u.a.reset)}}),i.a.createElement(E,{color:"white",size:50,style:{margin:0},label:"Exit",text:"\u2573",onPress:function(){return function(){if(!g)throw Error("No socket");O({username:void 0,room:void 0}),n&&n(!0),g.emit(m.b.PLAYER_LEFT,y.username),C.navigate("Root")}()}})),i.a.createElement(o.a,{style:{flexDirection:"row",alignItems:"center",marginTop:20}},i.a.createElement(o.a,{style:{marginRight:20}},i.a.createElement(E,{color:P?"#c0c0c0":"#5a65f1",size:160,label:"Drop(Space)",style:{marginTop:20},disabled:P||t,onPress:function(){return R(u.a.space)}})),i.a.createElement(o.a,{style:{marginLeft:20}},i.a.createElement(E,{color:P?"#c0c0c0":"#5a65f1",size:70,style:{margin:0},disabled:P||t,onPress:function(){return R(u.a.rotate)}}),i.a.createElement(o.a,{style:{flexDirection:"row"}},i.a.createElement(E,{color:P?"#c0c0c0":"#5a65f1",size:70,style:{margin:0,marginRight:60},disabled:P||t,onPress:function(){return R(u.a.left)}}),i.a.createElement(E,{color:P?"#c0c0c0":"#5a65f1",size:70,style:{margin:0},disabled:P||t,onPress:function(){return R(u.a.right)}})),i.a.createElement(E,{color:P?"#c0c0c0":"#5a65f1",size:70,style:{margin:0},disabled:P||t,onPress:function(){return R(u.a.down)}})))))},b=n(5),g=n.n(b),h=n(30),y=function(){return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"window",t=s.useState((function(){return h.a.get(e)})),n=g()(t,2),r=n[0],a=n[1];return s.useEffect((function(){var t=!0,n=function(n){t&&a(n[e])};return h.a.addEventListener("change",n),function(){t=!1,h.a.removeEventListener("change",n)}}),[e,a]),r}("window")},O=n(106),C=function(e){var t=e.isMultiplayerMode,n=e.opponentsNumber,r=e.isLeader;return e.gameover?i.a.createElement(o.a,{style:{alignItems:"center"}},i.a.createElement(a.a,{style:S.gameover},"Game Over"),i.a.createElement(a.a,{style:S.gameMode},"Please wait for other players to finish")):t?i.a.createElement(o.a,{style:{alignItems:"center"}},i.a.createElement(a.a,{style:S.gameMode},"You are in multiplayer mode"),i.a.createElement(a.a,{style:S.gameMode},n," other player(s) in your room"),i.a.createElement(a.a,null,function(e,t){return e<=0?"Wait for other players":e>0&&e+1>=O.a&&t?"Room is full, press Start to begin":e>0&&t?"Press Start to begin":e>0&&e+1>=O.a&&!t?"Room is full, ask leader to start the game":e>0&&!t?"Wait for leader to start the game":void 0}(n,r))):i.a.createElement(o.a,{style:{alignItems:"center"}},i.a.createElement(a.a,{style:S.gameMode},"You are in solo mode"),i.a.createElement(a.a,null,"Press Play(P) to start"))};function v(e){var t,n=e.children,r=e.isPause,c=e.setIsPause,l=e.roomPlayers,u=e.isLeader,m=e.gameStarted,f=e.gameover,E=e.isSoloMode,b=Object(s.useContext)(d.a).userContext,g=l&&0!==l.length?l.length-1:0,h=!(!b.username||!b.room||E),O=y(),v=O.width,P=O.height;t=P/v<1.5?P/960:v/560;var R=f;return i.a.createElement(o.a,{style:S.container},i.a.createElement(o.a,{style:[S.gameboy,{transform:[{scale:t}]}]},i.a.createElement(a.a,{style:S.title},"R E D \u25a0 T E T R I S"),i.a.createElement(o.a,{style:S.display},n,r?i.a.createElement(o.a,{style:[S.display,{position:"absolute",opacity:.8}]},i.a.createElement(C,{isMultiplayerMode:h,opponentsNumber:g,isLeader:u,gameover:f})):null),i.a.createElement(p,{isPause:r,setIsPause:c,opponentsNumber:g,isLeader:u,gameStarted:m,disabled:R,isSoloMode:E})))}var S=r.a.create({container:{flex:1,backgroundColor:"#1f393e",alignItems:"center",justifyContent:"center",padding:20,height:"100%"},display:{alignItems:"center",backgroundColor:"#9ead86",borderBottomColor:"#fa6b6b",borderLeftColor:"#980f0f",borderRightColor:"#fa6b6b",borderTopColor:"#980f0f",borderWidth:5,height:500,justifyContent:"center",padding:10,width:400},gameboy:{justifyContent:"center",alignItems:"center",backgroundColor:"#990011",borderRadius:20,paddingBottom:30,paddingHorizontal:50},title:{fontSize:30,marginVertical:15,textAlign:"center"},gameMode:{marginBottom:20,fontSize:18},gameover:{marginBottom:20,fontWeight:"bold",color:"#990011",fontSize:24}})}},[[319,1,2]]]);
//# sourceMappingURL=app.73043975.chunk.js.map